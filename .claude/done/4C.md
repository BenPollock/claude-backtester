# 4C: Signal Decay Analysis -- Completion Note

## What Was Implemented

Signal decay analysis module that measures how trade entry signals perform over subsequent trading days. This helps identify optimal holding periods by tracking cumulative returns at each horizon (T+1, T+2, ..., T+N) after trade entry.

### Four public functions:

1. **`compute_signal_returns(trades, price_data, max_horizon=20)`** -- For each trade, computes cumulative return from entry Close price at T+1 through T+max_horizon. Uses DataFrame index positions (trading days, not calendar days). Marks post-exit and beyond-data horizons as NaN.

2. **`average_signal_decay(signal_returns_df)`** -- Aggregates per-trade returns into mean, median, and std Series indexed by horizon. NaN values excluded via pandas default skipna behavior.

3. **`optimal_holding_period(signal_returns_df)`** -- Finds the horizon where mean cumulative return peaks. Handles monotonically increasing (optimal = max_horizon) and decreasing (optimal = 1) cases explicitly.

4. **`signal_decay_summary(trades, price_data, max_horizon=20)`** -- Convenience wrapper returning a dict with per_trade_returns, avg/median/std decay Series, optimal_holding dict, and total_signals count.

## Files Changed

| File | Action |
|------|--------|
| `src/backtester/analytics/signal_decay.py` | **Created** -- New module with 4 functions |
| `tests/test_signal_decay.py` | **Created** -- 17 tests across 4 test classes |

No existing files were modified.

## Tests Added (17 total)

**TestComputeSignalReturns (7 tests):**
- Basic returns with known prices (T+1 through T+5 verified by hand)
- Trade exited before max_horizon produces NaN for later periods
- Empty trades list returns empty DataFrame with correct columns
- Ticker not in price_data produces all-NaN row
- Single trade produces valid single-row result
- Horizon beyond available data produces NaN
- Multiple trades on same ticker produce separate rows

**TestAverageSignalDecay (3 tests):**
- Mean/median/std across multiple trades with known values
- Empty DataFrame returns empty Series
- NaN values excluded from aggregation

**TestOptimalHoldingPeriod (4 tests):**
- Peak in the middle of horizon range
- Monotonically increasing returns -> optimal = max_horizon
- Monotonically decreasing returns -> optimal = 1
- Empty input returns zero defaults

**TestSignalDecaySummary (3 tests):**
- End-to-end integration with two tickers and multiple trades
- No trades yields empty results and zero counts
- Single trade produces valid summary

## Deviations

- **signal_side field**: The Trade dataclass does not have an explicit `side` field. Since the backtester is long-only (BUY to enter, SELL to exit), all trades are hardcoded as `signal_side="BUY"` in the output. If short-selling is added later, this field would need to be derived from trade context.
- **`average_signal_decay` return type**: Returns a tuple of three Series `(mean, median, std)` rather than embedding them in a single structure, since the caller (`signal_decay_summary`) unpacks them into separate dict keys anyway.
